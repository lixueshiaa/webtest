var Ae=Object.defineProperty,Se=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var $=(d,l,a)=>l in d?Ae(d,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[l]=a,K=(d,l)=>{for(var a in l||(l={}))Fe.call(l,a)&&$(d,a,l[a]);if(Q)for(var a of Q(l))De.call(l,a)&&$(d,a,l[a]);return d},W=(d,l)=>Se(d,ye(l));var S=(d,l,a)=>new Promise((R,k)=>{var M=p=>{try{g(a.next(p))}catch(C){k(C)}},B=p=>{try{g(a.throw(p))}catch(C){k(C)}},g=p=>p.done?R(p.value):Promise.resolve(p.value).then(M,B);g((a=a.apply(d,l)).next())});import{B as Be}from"./BasicTable.1032ab26.js";import{T as ve}from"./componentMap.6942b0b6.js";import"./TableImg.39540c6d.js";import{a as te,u as Ee,bn as ke,z as b,b9 as Me,bw as xe,bj as Y,bO as I,j as f,U as A,o as c,i as y,k as F,ai as Z,p as w,G as r,N as L,a9 as Ie,J as D,t as q,l as z,n as Le,bR as Re,by as ee,bo as Te,Q as H}from"./index.9eb451d3.js";import"./index.9788db2e.js";import{u as je}from"./useListPage.b997c0e2.js";import{s as Ne}from"./onlineNew.7fc4ec7d.js";import Oe from"./TsLeaveModal.8f6d3395.js";import Je from"./TsLeaveAuditModal.4e7d082c.js";import{l as Pe,c as Ue,s as X,g as Ve,a as qe,b as ze,d as He,e as Xe,f as Ge,h as Qe,i as $e}from"./TsLeave.api.071e11ee.js";import{d as Ke}from"./download.de7e8375.js";import"./BasicForm.d1b5a4f4.js";import"./FormItem.vue_vue_type_script_lang.1dbd23cc.js";import"./BasicModal.a7306b6e.js";import"./useWindowSizeFn.ed181042.js";import"./useForm.26fd4105.js";import"./RadioButtonGroup.6d9641c3.js";import"./useFormItem.b38dda7e.js";import"./JDictSelectTag.3b1f5a5e.js";import"./JUpload.38683df0.js";import"./api.632a718d.js";import"./functional.8b995981.js";import"./index.83e82d5a.js";import"./onMountedOrActivated.bab7e2a6.js";import"./useContentViewHeight.0d594355.js";import"./FormOutlined.22ab579b.js";import"./useSortable.043e591f.js";import"./index.5df19bc8.js";import"./index.509a06e4.js";import"./index.dd61c578.js";import"./useCountdown.71e244f9.js";import"./props.d56cca40.js";import"./Tree.vue_vue_type_style_index_0_lang.1f840683.js";import"./useContextMenu.27080093.js";import"./index.e63dfd63.js";import"./index.c61598b5.js";import"./htmlmixed.95cdf531.js";import"./vue.e841ff5e.js";import"./depart.api.03e31315.js";import"./index.5fc45d81.js";import"./EditOutlined.1cd3ad58.js";import"./useTable.44d02b40.js";import"./render.9a5e321f.js";import"./index.e3d374a0.js";import"./base64Conver.bb012c73.js";const We=D(" \u5220\u9664 "),Ye=D("\u6279\u91CF\u64CD\u4F5C "),Ze=["innerHTML"],et={key:0,style:{"font-size":"12px","font-style":"italic"}},tt=D("\u4E0B\u8F7D"),ot=te({name:"tsLeave-tsLeave"}),Kt=te(W(K({},ot),{props:{query:{type:Object,default:{}}},setup(d,{expose:l}){const a=d,{apiUrl:R=""}=Ee(),k=ke(),M={},B=b(null),g=b(null),p=b(null),C=b(null),{hasPermission:_}=Me(),G=[],T=b([{label:"\u65B0\u589E",methods:"handleAdd",preIcon:"ant-design:plus-outlined",ifShowMethod:"handleAddShow"}]),j=b([{label:"\u7F16\u8F91",methods:"handleEdit",ifShowMethod:"handleEditFlowShow"},{label:"\u53D1\u8D77\u5BA1\u6279",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u63D0\u4EA4\u6D41\u7A0B\u5417\uFF1F",methods:"handleDeploy"},ifShowMethod:"handleDeployShow"},{label:"\u5F53\u524D\u6D41\u7A0B",methods:"handleShowCurFlow"}]),N=b([{label:"\u8BE6\u60C5",methods:"handleDetail",ifShowMethod:"handleDetailShow"},{label:"\u5BA1\u6838",methods:"handleAudit",ifShowMethod:"handleAuditShow"},{label:"\u7EC8\u5BA1\u9A73\u56DE",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5BA1\u6838\u9A73\u56DE\u5417\uFF1F",methods:"handleJudgmentReturn"},ifShowMethod:"handleJudgmentReturnShow"},{label:"\u5220\u9664",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664\u5417\uFF1F",methods:"handleDelete"}}]),i={handleAdd:function(){J(!0,{action:"add"})},handleEdit:function(e){J(!0,{record:e,action:"editor"})},handleAddShow:function(e){return _("tsLeave:add")},handleEditShow:function(e){return _("tsLeave:edit")},handleDetailShow:function(e){return _("tsLeave:detail")},handleExportShow:function(e){return _("tsLeave:export")},handleImportShow:function(e){return _("tsLeave:import")},handleAudit:function(e){ae(!0,{action:"audit",record:e})},handleAuditShow:function(e){return e.audit==1&&_("tsLeave:audit")},handleDeployShow:function(e){return e.exEdit&&(e.state=="start"||e.state=="reject")},handleJudgmentReturnShow:function(e){return e.state=="end"&&_("tsLeave:judgmentReturn")},handleTerminateShow:function(e){return e.state=="review"&&_("tsLeave:terminate")},handleEditFlowShow(e){return e.exEdit&&(e.state=="start"||e.state=="reject")},handleShowCurFlow:function(e){Re.info({title:"\u5F53\u524D\u6D41\u7A0B",width:"80%",icon:()=>ee("span"),closable:!0,content:()=>ee("iframe",{src:R+ze+e.orderId+"&token="+k,width:"100%",height:"600px"})})},handleDeploy:function(e){return S(this,null,function*(){yield He({id:e.id,taskId:e.taskId}),x()})},handleJudgmentReturn:function(e){return S(this,null,function*(){let s=[{id:e.id,taskId:null,orderId:e.orderId,reason:"\u7EC8\u5BA1\u9A73\u56DE",displayName:"end"}];yield Xe(s),x()})},handleTerminate:function(e){return S(this,null,function*(){let s=[{id:e.id,taskId:null,orderId:e.orderId,reason:"\u7EC8\u6B62\u6D41\u7A0B",displayName:"end"}];yield Ge(s),x()})},handleDetail:function(e){J(!0,{record:e,action:"detail"})},handleDelete:function(e){return S(this,null,function*(){yield Qe({id:e.id},v)})}},O=xe(),{currentRoute:oe}=O,[ne,{openModal:J}]=Y(),[ie,{openModal:ae}]=Y(),{prefixCls:nt,tableContext:le,onExportXls:ue,onImportXls:se}=je({tableProps:{title:"\u8BF7\u5047\u6D41\u7A0B",api:Pe,columns:Ue,canResize:!0,beforeFetch:e=>{const s=de(),t=I({},f(oe).query||{});let n=s.getFieldsValue()||{};Object.keys(n).map(h=>{n[h]?Array.isArray(n[h])&&(n[h]=n[h].join(",")):n[h]=""});const u=a.query||{},m=I(t,e,n,u);return Object.assign(e,m),Object.keys(e).map(h=>{for(let E=0;E<G.length;E++)e[G[E]]=void 0;(e[h]===""||e[h]===null)&&(e[h]=void 0)}),e},useSearchForm:!!X.length,pagination:void 0,formConfig:{schemas:X,autoSubmitOnEnter:!0,actionColOptions:{span:6,style:{textAlign:"left",paddingLeft:"10px"}},labelCol:Ne,wrapperCol:{},baseColProps:null,showAdvancedButton:!(X.length<=3),autoAdvancedCol:3,autoAdvancedLine:99,alwaysShowLines:99,searchActionColIndexValue:0,searchActionColIndexesModel:"N",fieldMapToNumber:[],fieldMapToTime:[]},actionColumn:{fixed:"right",width:240}},exportConfig:{name:"\u8BF7\u5047\u6D41\u7A0B",url:Ve},importConfig:{url:qe,success:v}});i.onExportXls=ue,i.onImportXls=se;const[re,P,U]=le,{reload:x,getForm:de}=P,{rowSelection:ce,selectedRowKeys:V}=U;function pe(e){return e.state=="end"?"green":e.audit==1?"red":"blue"}function me(e){return e.state=="end"?"\u5DF2\u7ED3\u675F":e.audit==1?"\u9700\u5BA1\u6279":"\u4E0D\u53EF\u5BA1\u6279"}function he(e){e&&e.split(",").map(t=>{Ke({url:Te(t)})})}function fe(){return S(this,null,function*(){yield $e({ids:V.value},v)})}function v(){(V.value=[])&&x()}function we(){return f(T).map(e=>{const s=H(e),t=s.methods;return s.onClick=()=>{i[t]&&i[t]()},s})}function _e(e){return f(j).map(s=>{const t=H(s),n=t.methods,u=I({},t.popConfirm||{}),m=t.ifShowMethod;return t.ifShow=m&&i[m]?i[m](e):!0,u.methods?(u.confirm=i[u.methods]&&i[u.methods].bind(null,e),t.popConfirm=u):n&&(t.onClick=i[n]&&i[n].bind(null,e)),t})}function ge(e){return f(N).map(s=>{const t=H(s),n=t.methods,u=I({},t.popConfirm||{}),m=t.ifShowMethod;return t.ifShow=m&&i[m]?i[m](e):!0,u.methods?(u.confirm=i[u.methods]&&i[u.methods].bind(null,e),t.popConfirm=u):n&&(t.onClick=i[n]&&i[n].bind(null,e)),t})}return M["./tsLeaveMixin.ts"]&&M["./tsLeaveMixin.ts"].default({methods:i,actionBtns:j,dropDownActionBtns:N,titleBtns:T,tableMethods:P,selections:U,router:O,bottomComponent:B,topComponent:g,topRef:p,bottomRef:C}),l({methods:i,actionBtns:j,dropDownActionBtns:N,titleBtns:T,tableMethods:P,selections:U,router:O,bottomComponent:B,topComponent:g,topRef:p,bottomRef:C}),(e,s)=>{const t=A("j-upload-button"),n=A("a-button"),u=A("Icon"),m=A("a-menu-item"),h=A("a-menu"),E=A("a-dropdown"),Ce=A("a-tag");return c(),y("div",null,[(c(),F(Z(g.value),{ref_key:"topRef",ref:p},null,512)),w(f(Be),{onRegister:f(re),rowSelection:f(ce)},{tableTitle:r(()=>[(c(!0),y(L,null,Ie(we(),(o,be)=>(c(),y(L,null,[o.btnType==="import"?(c(),y(L,{key:0},[o.ifShow!==!1?(c(),F(t,{key:0,type:"primary",disabled:o.disabled===!0,preIcon:o.preIcon,onClick:o.onClick},{default:r(()=>[D(q(o.label),1)]),_:2},1032,["disabled","preIcon","onClick"])):z("",!0)],64)):(c(),y(L,{key:1},[o.ifShow!==!1?(c(),F(n,{key:0,type:"primary",disabled:o.disabled===!0,preIcon:o.preIcon,onClick:o.onClick},{default:r(()=>[D(q(o.label),1)]),_:2},1032,["disabled","preIcon","onClick"])):z("",!0)],64))],64))),256)),f(V).length>0?(c(),F(E,{key:0},{overlay:r(()=>[w(h,null,{default:r(()=>[w(m,{key:"1",onClick:fe},{default:r(()=>[w(u,{icon:"ant-design:delete-outlined"}),We]),_:1})]),_:1})]),default:r(()=>[w(n,null,{default:r(()=>[Ye,w(u,{icon:"mdi:chevron-down"})]),_:1})]),_:1})):z("",!0)]),action:r(({record:o})=>[w(f(ve),{actions:_e(o),dropDownActions:ge(o)},null,8,["actions","dropDownActions"])]),htmlSlot:r(({text:o})=>[Le("div",{innerHTML:o},null,8,Ze)]),fileSlot:r(({text:o})=>[o?(c(),F(n,{key:1,ghost:!0,type:"primary",preIcon:"ant-design:download-outlined",size:"small",onClick:be=>he(o)},{default:r(()=>[tt]),_:2},1032,["onClick"])):(c(),y("span",et,"\u65E0\u6587\u4EF6"))]),flowSlot:r(({record:o})=>[w(Ce,{color:pe(o)},{default:r(()=>[D(q(me(o)),1)]),_:2},1032,["color"])]),_:1},8,["onRegister","rowSelection"]),(c(),F(Z(B.value),{ref_key:"bottomRef",ref:C},null,512)),w(Oe,{onRegister:f(ne),onSuccess:v},null,8,["onRegister"]),w(Je,{onRegister:f(ie),onSuccess:v},null,8,["onRegister"])])}}}));export{Kt as default};
