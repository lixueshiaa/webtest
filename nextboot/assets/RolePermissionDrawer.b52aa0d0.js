var v=(_,y,s)=>new Promise((d,u)=>{var f=o=>{try{r(s.next(o))}catch(n){u(n)}},i=o=>{try{r(s.throw(o))}catch(n){u(n)}},r=o=>o.done?d(o.value):Promise.resolve(o.value).then(f,i);r((s=s.apply(_,y)).next())});import{u as $,a as N,B as j}from"./index.c1ddc319.js";import{_ as q}from"./Tree.vue_vue_type_style_index_0_lang.b76a1360.js";import{a as L,z as l,j as t,U as R,o as F,k as I,G as c,p as m,b7 as V,J as g,t as A,l as z,ad as G}from"./index.d537950e.js";import J from"./RoleDataRuleDrawer.5228606f.js";import{q as O,c as U,e as H}from"./role.api.ebd905b4.js";import"./useContextMenu.7a70fb68.js";const M=g("\u53D6\u6D88"),Q=g("\u4EC5\u4FDD\u5B58"),W=g("\u4FDD\u5B58\u5E76\u5173\u95ED"),ae=L({__name:"RolePermissionDrawer",emits:["register"],setup(_,{emit:y}){const s=l([]),d=l([]),u=l([]),f=l([]),i=l([]),r=l(""),o=l(null),n=l(!1),[K,{openDrawer:x}]=$(),[E,{setDrawerProps:w,closeDrawer:h}]=N(e=>v(this,null,function*(){yield b(),w({confirmLoading:!1,loading:!0}),r.value=e.roleId;const a=yield O();s.value=a.treeList,d.value=a.ids;const p=yield U({roleId:t(r)});u.value=p,f.value=p,w({loading:!1})}));function B(e){u.value=e.checked?e.checked:e}function T(e){e&&e.length>0&&(i.value=e),x(!0,{functionId:t(i)[0],roleId:t(r)})}function b(){s.value=[],d.value=[],u.value=[],f.value=[],i.value=[],r.value=""}function P(){const e=t(o);if(!e)throw new Error("tree is null!");return e}function k(e){return v(this,null,function*(){let a={roleId:t(r),permissionIds:t(P().getCheckedKeys()).join(","),lastpermissionIds:t(f).join(",")};n.value=!0,yield H(a),n.value=!1,e&&h()})}return(e,a)=>{const p=R("Icon"),C=R("a-button");return F(),I(t(j),G(e.$attrs,{onRegister:t(E),title:"\u89D2\u8272\u6743\u9650\u914D\u7F6E",width:"650px",destroyOnClose:"",showFooter:""}),{footer:c(()=>[m(t(V),{title:"\u786E\u5B9A\u653E\u5F03\u7F16\u8F91\uFF1F",onConfirm:t(h),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"},{default:c(()=>[M]),_:1},8,["onConfirm"]),m(C,{onClick:a[0]||(a[0]=D=>k(!1)),type:"primary",loading:n.value,ghost:"",style:{"margin-right":"0.8rem"}},{default:c(()=>[Q]),_:1},8,["loading"]),m(C,{onClick:a[1]||(a[1]=D=>k(!0)),type:"primary",loading:n.value},{default:c(()=>[W]),_:1},8,["loading"])]),default:c(()=>[m(t(q),{ref_key:"treeRef",ref:o,checkable:"",toolbar:"",treeData:s.value,checkedKeys:u.value,expandedKeys:d.value,selectedKeys:i.value,checkStrictly:!0,clickRowToExpand:!1,title:"\u6240\u62E5\u6709\u7684\u7684\u6743\u9650",onCheck:B,onSelect:T},{title:c(({slotTitle:D,ruleFlag:S})=>[g(A(D)+" ",1),S?(F(),I(p,{key:0,icon:"ant-design:align-left-outlined",style:{"margin-left":"5px",color:"red"}})):z("",!0)]),_:1},8,["treeData","checkedKeys","expandedKeys","selectedKeys"]),m(J,{onRegister:t(K)},null,8,["onRegister"])]),_:1},16,["onRegister"])}}});export{ae as default};
