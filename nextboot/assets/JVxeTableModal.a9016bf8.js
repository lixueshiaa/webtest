var q=Object.defineProperty,N=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var R=(e,t,a)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,S=(e,t)=>{for(var a in t||(t={}))I.call(t,a)&&R(e,a,t[a]);if($)for(var a of $(t))Y.call(t,a)&&R(e,a,t[a]);return e},V=(e,t)=>N(e,H(t));var _=(e,t,a)=>new Promise((f,i)=>{var p=l=>{try{s(a.next(l))}catch(b){i(b)}},c=l=>{try{s(a.throw(l))}catch(b){i(b)}},s=l=>l.done?f(l.value):Promise.resolve(l.value).then(p,c);s((a=a.apply(e,t)).next())});import{B as z}from"./index.9788db2e.js";import{ea as D,z as h,a0 as G,j as w,a as X,eb as Q,B as C,bg as W,f as Z,a1 as x,U as F,o as ee,k as te,G as n,p as o,ad as ae,J as O}from"./index.9eb451d3.js";import{o as ue,a as oe,s as le}from"./jvxetable.api.d5b38718.js";import"./BasicModal.a7306b6e.js";import"./useWindowSizeFn.ed181042.js";const re=[{title:"\u5BA2\u6237\u540D",key:"name",width:180,type:D.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u6027\u522B",key:"sex",width:180,type:D.select,options:[{title:"\u7537",value:"1"},{title:"\u5973",value:"2"}],defaultValue:"",placeholder:"\u8BF7\u9009\u62E9${title}"},{title:"\u8EAB\u4EFD\u8BC1\u53F7",key:"idcard",width:180,type:D.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{pattern:"^\\d{6}(18|19|20)?\\d{2}(0[1-9]|1[012])(0[1-9]|[12]\\d|3[01])\\d{3}(\\d|[xX])$",message:"${title}\u683C\u5F0F\u4E0D\u6B63\u786E"}]},{title:"\u624B\u673A\u53F7",key:"telphone",width:180,type:D.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{pattern:"^1(3|4|5|7|8)\\d{9}$",message:"${title}\u683C\u5F0F\u4E0D\u6B63\u786E"}]}],ne=[{title:"\u822A\u73ED\u53F7",key:"ticketCode",width:180,type:D.input,defaultValue:"",placeholder:"\u8BF7\u8F93\u5165${title}",validateRules:[{required:!0,message:"${title}\u4E0D\u80FD\u4E3A\u7A7A"}]},{title:"\u822A\u73ED\u65F6\u95F4",key:"tickectDate",width:180,type:D.date,placeholder:"\u8BF7\u9009\u62E9${title}",defaultValue:""}],k=Symbol();function se(e,t,a,f){return _(this,null,function*(){if(!(e&&typeof e=="function"))throw`validate \u53C2\u6570\u9700\u8981\u7684\u662F\u4E00\u4E2A\u65B9\u6CD5\uFF0C\u800C\u4F20\u5165\u7684\u5374\u662F${typeof e}`;let i={},p=yield new Promise((s,l)=>{e().then(()=>{s(t)}).catch(()=>{l({error:k})})});Object.assign(i,{formValue:p});let c=yield ie(a,f);return i=Object.assign(i,{tablesValue:c}),i})}function ie(e,t=!0){if(!(e instanceof Array))throw`'validateTables'\u51FD\u6570\u7684'cases'\u53C2\u6570\u9700\u8981\u7684\u662F\u4E00\u4E2A\u6570\u7EC4\uFF0C\u800C\u4F20\u5165\u7684\u5374\u662F${typeof e}`;return new Promise((a,f)=>{let i=[],p=0;(!e||e.length===0)&&a(i),function c(){let s=e[p];s.value.validateTable().then(l=>{if(!l)i[p]={tableData:s.value.getTableData()},++p===e.length?a(i):c();else{let b,v=T(s.value,"ATabPane");if(v&&(b=v.$.vnode.key,t)){let y=T(v,"Tabs");y&&y.setActiveKey&&y.setActiveKey(b)}f({error:k,index:p,paneKey:b,errMap:l})}})}()})}function T(e,t){let a=e.$parent;if(a&&a.$options){if(a.$options.name===t)return a;{let f=T(a,t);if(f)return f}}return null}function de(e,t,a,f,i,p){const c=h();function s(u,m,g,M){g.loading=!0,G.get({url:u,params:m},{isTransformResponse:!1}).then(B=>{let{result:r}=B;B.success&&r&&(Array.isArray(r)?g.dataSource=r:Array.isArray(r.records)&&(g.dataSource=r.records)),typeof M=="function"&&M(B)}).finally(()=>{g.loading=!1})}function l(u){var m,g;(g=(m=a[u])==null?void 0:m.value)==null||g.resetScrollTop(0)}function b(){let u=Object.values(a);return Promise.all(u)}function v(){b().then(u=>{let m=c.value.getFieldsValue();return se(c.value.validate,m,u)}).then(u=>p&&typeof p=="function"?p(u):y(u)).then(u=>{if(typeof t!="function")throw d("classifyIntoFormData");let m=t(u);return e(m)}).catch(u=>{u.error===k?f.value=u.index==null?w(f):i.value[u.index]:console.error(u)})}function y(u){return new Promise(m=>{m(u)})}function d(u){return`${u} \u672A\u5B9A\u4E49\u6216\u4E0D\u662F\u4E00\u4E2A\u51FD\u6570`}return[l,v,s,c]}const ce=X({name:"JVexTableModal",components:{BasicModal:z,JVxeTable:Q},emits:["success","register"],setup(e,{emit:t}){const a=h(!0),f=h(),i=h(),p=h(["tableRef1","tableRef2"]),c=h("tableRef1"),s={tableRef1:f,tableRef2:i},l=C({xs:{span:24},sm:{span:5}}),b=C({xs:{span:24},sm:{span:16}}),v=C({loading:!1,dataSource:[],columns:re}),y=C({loading:!1,dataSource:[],columns:ne}),d=C({id:null,orderCode:"",orderMoney:"",ctype:"",content:"",jeecgOrderCustomerList:[],jeecgOrderTicketList:[]}),[u,m,g,M]=de(J,K,s,c,p),[B,{setModalProps:r,closeModal:j}]=W(A=>_(this,null,function*(){if(r({confirmLoading:!1}),P(),a.value=!!(A!=null&&A.isUpdate),w(a)){Object.assign(d,A.record);let E={id:d.id};g(ue,E,v),g(oe,E,y)}})),L={orderCode:[{required:!0,message:"\u8BA2\u5355\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},U=Z(()=>w(a)?"\u7F16\u8F91":"\u65B0\u589E");function K(A){let E=Object.assign(d,A.formValue);return V(S({},E),{jeecgOrderCustomerList:A.tablesValue[0].tableData,jeecgOrderTicketList:A.tablesValue[1].tableData})}function P(){d.id=null,d.orderCode="",d.orderMoney="",d.orderDate=null,d.ctype="",d.content="",d.jeecgOrderCustomerList=[],d.jeecgOrderTicketList=[]}function J(A){return _(this,null,function*(){r({confirmLoading:!0}),yield le(A,w(a)),j(),t("success")})}return{formRef:M,activeKey:c,table1:v,table2:y,tableRef1:f,tableRef2:i,getTitle:U,labelCol:l,wrapperCol:b,validatorRules:L,orderMainModel:d,registerModal:B,handleChangeTabs:u,handleSubmit:m}}}),fe=O("\u56FD\u5185\u8BA2\u5355"),pe=O("\u56FD\u9645\u8BA2\u5355");function me(e,t,a,f,i,p){const c=F("a-input"),s=F("a-form-item"),l=F("a-col"),b=F("a-select-option"),v=F("a-select"),y=F("a-date-picker"),d=F("a-row"),u=F("JVxeTable"),m=F("a-tab-pane"),g=F("a-tabs"),M=F("a-form"),B=F("BasicModal");return ee(),te(B,ae(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit,width:"70%"}),{default:n(()=>[o(M,{ref:"formRef",model:e.orderMainModel,"label-col":e.labelCol,"wrapper-col":e.wrapperCol,rules:e.validatorRules},{default:n(()=>[o(d,{class:"form-row",gutter:16},{default:n(()=>[o(l,{lg:8},{default:n(()=>[o(s,{label:"\u8BA2\u5355\u53F7",name:"orderCode"},{default:n(()=>[o(c,{value:e.orderMainModel.orderCode,"onUpdate:value":t[0]||(t[0]=r=>e.orderMainModel.orderCode=r),placeholder:"\u8BF7\u8F93\u5165\u8BA2\u5355\u53F7"},null,8,["value"])]),_:1})]),_:1}),o(l,{lg:8},{default:n(()=>[o(s,{label:"\u8BA2\u5355\u7C7B\u578B",name:"ctype"},{default:n(()=>[o(v,{placeholder:"\u8BF7\u9009\u62E9\u8BA2\u5355\u7C7B\u578B",value:e.orderMainModel.ctype,"onUpdate:value":t[1]||(t[1]=r=>e.orderMainModel.ctype=r)},{default:n(()=>[o(b,{value:"1"},{default:n(()=>[fe]),_:1}),o(b,{value:"2"},{default:n(()=>[pe]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(l,{lg:8},{default:n(()=>[o(s,{label:"\u8BA2\u5355\u65E5\u671F",name:"orderDate"},{default:n(()=>[o(y,{showTime:"",valueFormat:"YYYY-MM-DD HH:mm:ss",value:e.orderMainModel.orderDate,"onUpdate:value":t[2]||(t[2]=r=>e.orderMainModel.orderDate=r)},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(d,{class:"form-row",gutter:16},{default:n(()=>[o(l,{lg:8},{default:n(()=>[o(s,{label:"\u8BA2\u5355\u91D1\u989D",name:"orderMoney"},{default:n(()=>[o(c,{value:e.orderMainModel.orderMoney,"onUpdate:value":t[3]||(t[3]=r=>e.orderMainModel.orderMoney=r),placeholder:"\u8BF7\u8F93\u5165\u8BA2\u5355\u91D1\u989D"},null,8,["value"])]),_:1})]),_:1}),o(l,{lg:8},{default:n(()=>[o(s,{label:"\u8BA2\u5355\u5907\u6CE8",name:"content"},{default:n(()=>[o(c,{value:e.orderMainModel.content,"onUpdate:value":t[4]||(t[4]=r=>e.orderMainModel.content=r),placeholder:"\u8BF7\u8F93\u5165\u8BA2\u5355\u5907\u6CE8"},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(g,{activeKey:e.activeKey,"onUpdate:activeKey":t[5]||(t[5]=r=>e.activeKey=r),onChange:e.handleChangeTabs},{default:n(()=>[o(m,{tab:"\u5BA2\u6237\u4FE1\u606F",key:"tableRef1"},{default:n(()=>[o(u,{ref:"tableRef1",stripe:"",toolbar:"",rowNumber:"",rowSelection:"",resizable:"",keepSource:"",maxHeight:300,"checkbox-config":{range:!0},loading:e.table1.loading,columns:e.table1.columns,dataSource:e.table1.dataSource},null,8,["loading","columns","dataSource"])]),_:1}),o(m,{tab:"\u673A\u7968\u4FE1\u606F",key:"tableRef2",forceRender:""},{default:n(()=>[o(u,{ref:"tableRef2",stripe:"",toolbar:"",rowNumber:"",rowSelection:"",resizable:"",keepSource:"",maxHeight:300,"checkbox-config":{range:!0},loading:e.table2.loading,columns:e.table2.columns,dataSource:e.table2.dataSource},null,8,["loading","columns","dataSource"])]),_:1})]),_:1},8,["activeKey","onChange"])]),_:1},8,["model","label-col","wrapper-col","rules"])]),_:1},16,["onRegister","title","onOk"])}var Be=x(ce,[["render",me]]);export{Be as default};
