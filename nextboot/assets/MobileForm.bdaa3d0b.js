var S=(b,i,s)=>new Promise((f,m)=>{var p=o=>{try{u(s.next(o))}catch(n){m(n)}},c=o=>{try{u(s.throw(o))}catch(n){m(n)}},u=o=>o.done?f(o.value):Promise.resolve(o.value).then(p,c);u((s=s.apply(b,i)).next())});import{a as w,F as _,c as B,y as E,z as k,B as R,f as z,j as e,o as M,i as T,p as t,G as r,I as D,K as x,J as v,t as C,N,l as V,Q as O,W as U,T as $}from"./index.0c676cb0.js";import{C as A}from"./index.32a34a9d.js";import G from"./LoginFormTitle.04757a0c.js";import{u as W,a as j,L as J,S as K,b as P}from"./useLogin.6fcc4b16.js";import"./useCountdown.df5930af.js";import"./useFormItem.47fc2179.js";const se=w({__name:"MobileForm",setup(b){const i=_.Item,{t:s}=B(),{handleBackLogin:f,getLoginState:m}=W(),{getFormRules:p}=j(),{notification:c,createErrorModal:u}=$(),o=E(),n=k(),g=k(!1),l=R({mobile:"",sms:""}),{validForm:F}=P(n),h=z(()=>e(m)===J.MOBILE);function I(){return S(this,null,function*(){const d=yield F();if(!!d)try{g.value=!0;const a=yield o.phoneLogin(O({mobile:d.mobile,captcha:d.sms,mode:"none"}));a&&c.success({message:s("sys.login.loginSuccessTitle"),description:`${s("sys.login.loginSuccessDesc")}: ${a.realname}`,duration:3})}catch(a){c.error({message:s("sys.api.errorTip"),description:a.message||s("sys.api.networkExceptionMsg"),duration:3})}finally{g.value=!1}})}function L(){return U({mobile:l.mobile,smsmode:K.FORGET_PASSWORD})}return(d,a)=>e(h)?(M(),T(N,{key:0},[t(G,{class:"enter-x"}),t(e(_),{class:"p-4 enter-x",model:l,rules:e(p),ref_key:"formRef",ref:n},{default:r(()=>[t(e(i),{name:"mobile",class:"enter-x"},{default:r(()=>[t(e(D),{size:"large",value:l.mobile,"onUpdate:value":a[0]||(a[0]=y=>l.mobile=y),placeholder:e(s)("sys.login.mobile"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),t(e(i),{name:"sms",class:"enter-x"},{default:r(()=>[t(e(A),{size:"large",class:"fix-auto-fill",value:l.sms,"onUpdate:value":a[1]||(a[1]=y=>l.sms=y),placeholder:e(s)("sys.login.smsCode"),sendCodeApi:L},null,8,["value","placeholder"])]),_:1}),t(e(i),{class:"enter-x"},{default:r(()=>[t(e(x),{type:"primary",size:"large",block:"",onClick:I,loading:g.value},{default:r(()=>[v(C(e(s)("sys.login.loginButton")),1)]),_:1},8,["loading"]),t(e(x),{size:"large",block:"",class:"mt-4",onClick:e(f)},{default:r(()=>[v(C(e(s)("sys.login.backSignIn")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])],64)):V("",!0)}});export{se as default};
