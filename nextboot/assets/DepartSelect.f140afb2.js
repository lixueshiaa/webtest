var E=(v,w,c)=>new Promise((f,y)=>{var T=l=>{try{D(c.next(l))}catch(s){y(s)}},x=l=>{try{D(c.throw(l))}catch(s){y(s)}},D=l=>l.done?f(l.value):Promise.resolve(l.value).then(T,x);D((c=c.apply(v,w)).next())});import{B as ue}from"./index.f8f2ddf0.js";import{g as le,h as se}from"./depart.api.cb5ba1c2.js";import{c as oe}from"./tenant.api.49a02da2.js";import{a1 as ne,a as re,y as ie,z as r,X as ce,U as p,o as m,k as h,G as a,p as i,r as R,i as $,a9 as j,N as q,l as G,ad as J,j as e,J as C,t as Q,bP as fe,bQ as de,n as X,T as pe}from"./index.6cf4d174.js";import"./BasicModal.45214da2.js";import"./useWindowSizeFn.99e468e7.js";const K=v=>(fe("data-v-1bb49f26"),v=v(),de(),v),ve=K(()=>X("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u79DF\u6237\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5C5E\u79DF\u6237",-1)),_e=C(" \u79DF\u6237 "),me=K(()=>X("span",null,"\u60A8\u96B6\u5C5E\u4E8E\u591A\u90E8\u95E8\uFF0C\u8BF7\u9009\u62E9\u5F53\u524D\u6240\u5728\u90E8\u95E8",-1)),ge=C(" \u90E8\u95E8 "),Fe=C("\u5173\u95ED"),Ee=C("\u786E\u8BA4"),Ce=re({__name:"DepartSelect",props:{title:{type:String,default:"\u90E8\u95E8\u9009\u62E9"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(v,{expose:w}){const c=v,f=ie(),{createMessage:y,notification:T}=pe(),x={labelCol:{span:4},wrapperCol:{span:18}},D={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},l=r(""),s=r(!1),B=r(""),_=r(),N=r([]),S=r(""),d=r(!1),b=r(""),g=r(""),U=r([]),I=r(""),k=r(!1);function O(){return E(this,null,function*(){yield A(),yield W(),e(s)&&e(d)?l.value="\u5207\u6362\u79DF\u6237\u548C\u90E8\u95E8":e(s)?l.value=e(B)&&e(B).length>0?`\u79DF\u6237\u5207\u6362\uFF08\u5F53\u524D\u79DF\u6237 :${e(B)}\uFF09`:c.title:e(d)&&(l.value=e(b)&&e(b).length>0?`\u90E8\u95E8\u5207\u6362\uFF08\u5F53\u524D\u90E8\u95E8 :${e(b)}\uFF09`:c.title),(e(s)||e(d))&&(k.value=!0)})}function A(){return E(this,null,function*(){const t=yield le();if(!t.list||t.list.length==0)return;let u=t.list.filter(n=>n.orgCode==t.orgCode);U.value=t.list,g.value=u&&u.length>0?t.orgCode:"",b.value=u&&u.length>0?u[0].departName:"",d.value=!0})}function W(){return E(this,null,function*(){const t=yield oe();if(!t.list||t.list.length==0)return;let u=f.getTenant,n=t.list.filter(F=>F.id==u);B.value=n&&n.length>0?n[0].name:"",N.value=t.list,_.value=u,s.value=!0})}function Y(){return E(this,null,function*(){if(e(s)&&!e(_))return S.value="error",!1;if(e(d)&&!e(g))return I.value="error",!1;Z().then(()=>{e(s)&&f.setTenant(e(_)),y.success("\u5207\u6362\u6210\u529F")}).catch(t=>{console.log("\u767B\u5F55\u9009\u62E9\u51FA\u73B0\u95EE\u9898",t)}).finally(()=>{e(s)&&f.setTenant(e(_)),L()})})}function Z(){return new Promise((t,u)=>E(this,null,function*(){if(!e(d))t();else{const n=yield se({username:f.getUserInfo.username,orgCode:e(g)});if(n.userInfo){const F=n.userInfo;f.setUserInfo(F),t()}else ee(n),f.logout(),u()}}))}function ee(t){T.error({message:"\u767B\u5F55\u5931\u8D25",description:((t.response||{}).data||{}).message||t.message||"\u8BF7\u6C42\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",duration:4})}function L(){te()}function te(){l.value="",s.value=!1,B.value="",_.value="",N.value=[],S.value="",d.value=!1,b.value="",g.value="",U.value=[],I.value="",k.value=!1}return ce(()=>c.username,t=>{t&&A()}),w({show:O}),(t,u)=>{const n=p("a-avatar"),F=p("a-tooltip"),M=p("Icon"),z=p("a-select-option"),V=p("a-select"),P=p("a-form-item"),ae=p("a-form"),H=p("a-button");return m(),h(e(ue),J(D,{title:l.value,visible:k.value,"onUpdate:visible":u[2]||(u[2]=o=>k.value=o),wrapClassName:"loginSelectModal"}),{footer:a(()=>[i(H,{onClick:L},{default:a(()=>[Fe]),_:1}),i(H,{onClick:Y,type:"primary"},{default:a(()=>[Ee]),_:1})]),default:a(()=>[i(ae,J({ref:"formRef"},x,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[s.value?(m(),h(P,{key:0,"validate-status":S.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[ve]),default:a(()=>[i(n,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[_e]),_:1})]),_:1})]),default:a(()=>[i(V,{value:_.value,"onUpdate:value":u[0]||(u[0]=o=>_.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:R({"valid-error":S.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),$(q,null,j(N.value,o=>(m(),h(z,{key:o.id,value:o.id},{default:a(()=>[C(Q(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):G("",!0),d.value?(m(),h(P,{key:1,"validate-status":I.value},{label:a(()=>[i(F,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[i(n,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[ge]),_:1})]),_:1})]),default:a(()=>[i(V,{value:g.value,"onUpdate:value":u[1]||(u[1]=o=>g.value=o),placeholder:"\u8BF7\u9009\u62E9\u767B\u5F55\u90E8\u95E8",class:R({"valid-error":I.value=="error"})},{suffixIcon:a(()=>[i(M,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),$(q,null,j(U.value,o=>(m(),h(z,{key:o.orgCode,value:o.orgCode},{default:a(()=>[C(Q(o.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):G("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});var ke=ne(Ce,[["__scopeId","data-v-1bb49f26"]]);export{ke as default};
