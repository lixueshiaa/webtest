var f=(_,E,i)=>new Promise((A,k)=>{var w=r=>{try{a(i.next(r))}catch(n){k(n)}},p=r=>{try{a(i.throw(r))}catch(n){k(n)}},a=r=>r.done?A(r.value):Promise.resolve(r.value).then(w,p);a((i=i.apply(_,E)).next())});import"./index.9788db2e.js";import{a1 as pe,a as de,b4 as fe,z as u,bj as _e,U as c,o as h,k as C,G as o,n as x,p as l,l as V,i as me,j as I,fC as ye,t as ve,N as he,J as y,an as X,bP as ke,bQ as ge,T as De}from"./index.9eb451d3.js";import{o as Ce}from"./componentMap.6942b0b6.js";import{q as $,s as xe,A as q,d as Ee}from"./depart.user.api.5b8e68db.js";import Ae from"./DepartFormModal.8523cf32.js";import"./BasicModal.a7306b6e.js";import"./useWindowSizeFn.ed181042.js";import"./index.5df19bc8.js";import"./useFormItem.b38dda7e.js";import"./RadioButtonGroup.6d9641c3.js";import"./download.de7e8375.js";import"./base64Conver.bb012c73.js";import"./index.509a06e4.js";import"./index.dd61c578.js";import"./useCountdown.71e244f9.js";import"./api.632a718d.js";import"./props.d56cca40.js";import"./JDictSelectTag.3b1f5a5e.js";import"./Tree.vue_vue_type_style_index_0_lang.1f840683.js";import"./useContextMenu.27080093.js";import"./index.e63dfd63.js";import"./onMountedOrActivated.bab7e2a6.js";import"./index.c61598b5.js";import"./htmlmixed.95cdf531.js";import"./vue.e841ff5e.js";import"./depart.api.03e31315.js";import"./JUpload.38683df0.js";import"./functional.8b995981.js";import"./index.5fc45d81.js";import"./EditOutlined.1cd3ad58.js";import"./BasicForm.d1b5a4f4.js";import"./FormItem.vue_vue_type_script_lang.1dbd23cc.js";import"./useForm.26fd4105.js";import"./depart.user.data.02739732.js";import"./user.api.c26e46a3.js";const we=_=>(ke("data-v-5cc39c49"),_=_(),ge(),_),Te={class:"j-table-operator",style:{width:"100%"}},Be=y("\u65B0\u589E"),be=y("\u6DFB\u52A0\u4E0B\u7EA7"),Fe=y("\u5BFC\u5165"),Ie=y("\u5BFC\u51FA"),Ke=y("\u5220\u9664"),Se={class:"tree-contanier"},Le=y("\u6DFB\u52A0\u5B50\u7EA7"),Re=we(()=>x("span",{style:{color:"red"}},"\u5220\u9664",-1)),Ue=de({__name:"DepartLeftTree",emits:["select","rootTreeData"],setup(_,{expose:E,emit:i}){fe("prefixCls");const{createMessage:A}=De(),{handleImportXls:k,handleExportXls:w}=Ce(),p=u(!1),a=u([]),r=u([]),n=u([]),d=u([]),T=u(!1),z=u(!0),B=u(null),b=u(null),G=u(""),[J,{openModal:K}]=_e();function m(){return f(this,null,function*(){try{p.value=!0,a.value=[];const e=yield $();if(Array.isArray(e)&&(a.value=e),n.value.length===0)S();else if(d.value.length===0){let t=a.value[0];t&&g(t.id,t)}else i("select",B.value);i("rootTreeData",a.value)}finally{p.value=!1}})}m();function Q(e){return f(this,null,function*(){try{const t=yield $({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,n.value.length>0){let s=[];for(let D of n.value)t.findIndex(F=>F.id===D)!==-1&&s.push(D);s.length>0&&(n.value=[...n.value])}a.value=[...a.value],i("rootTreeData",a.value)}catch(t){console.error(t)}return Promise.resolve()})}function S(e){let t=a.value[0];e?L(t):t?(t.isLeaf||(n.value=[t.key]),g(t.id,t),W()):i("select",null)}function L(e){e.isLeaf||n.value.push(e.key),e.children&&e.children.length&&e.children.map(t=>{L(t)})}function W(){return f(this,null,function*(){yield X(),T.value=!0,yield X(),T.value=!1})}function g(e,t){d.value=[e],t&&(B.value=t,i("select",t))}function H(){K(!0,{isUpdate:!1,isChild:!1})}function R(e=B.value){if(e==null){A.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u90E8\u95E8");return}const t={parentId:e.id};K(!0,{isUpdate:!1,isChild:!0,record:t})}function O(e){return f(this,null,function*(){if(e)try{p.value=!0,a.value=[];let t=yield xe({keyWord:e});Array.isArray(t)&&(a.value=t),S(e)}finally{p.value=!1}else n.value=[],m();G.value=e})}function Y(e){Array.isArray(e)?r.value=e:r.value=e.checked}function Z(e,t){e.length>0&&d.value[0]!==e[0]?g(e[0],t.selectedNodes[0].props):g(d.value[0])}function U(e,t=!0){return f(this,null,function*(){const s=I(e);if(s.length>0)try{p.value=!0,yield Ee({ids:s.join(",")},t),yield m()}finally{p.value=!1}})}function ee(e){return f(this,null,function*(){e&&(M(!1),U([e.id],!1))})}function te(){return f(this,null,function*(){try{yield U(d),d.value=[]}finally{}})}function M(e){e||(b.value=null)}function ae(e){k(e,q.importExcelUrl,()=>{m()})}function oe(){w("\u90E8\u95E8\u4FE1\u606F",q.exportXlsUrl)}return E({loadRootTreeData:m}),(e,t)=>{const s=c("a-button"),D=c("a-upload"),F=c("a-input-search"),N=c("a-menu-item"),ne=c("a-menu"),le=c("a-dropdown"),re=c("a-tree"),se=c("a-empty"),ie=c("a-spin"),ue=c("a-card");return h(),C(ue,{bordered:!1,style:{height:"100%"}},{default:o(()=>[x("div",Te,[l(s,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:H},{default:o(()=>[Be]),_:1}),l(s,{type:"primary",preIcon:"ant-design:plus-outlined",onClick:t[0]||(t[0]=v=>R())},{default:o(()=>[be]),_:1}),l(D,{name:"file",showUploadList:!1,customRequest:ae},{default:o(()=>[l(s,{type:"primary",preIcon:"ant-design:import-outlined"},{default:o(()=>[Fe]),_:1})]),_:1}),l(s,{type:"primary",preIcon:"ant-design:export-outlined",onClick:oe},{default:o(()=>[Ie]),_:1}),d.value.length>0?(h(),C(s,{key:0,onClick:te,type:"primary",danger:"",preIcon:"ant-design:delete-outlined"},{default:o(()=>[Ke]),_:1})):V("",!0)]),l(ie,{spinning:p.value},{default:o(()=>[l(F,{placeholder:"\u6309\u90E8\u95E8\u540D\u79F0\u641C\u7D22\u2026",style:{"margin-bottom":"10px"},onSearch:O}),x("div",Se,[a.value.length>0?(h(),me(he,{key:0},[T.value?V("",!0):(h(),C(re,{key:0,checkable:!1,clickRowToExpand:!1,treeData:a.value,selectedKeys:d.value,checkStrictly:z.value,"load-data":Q,checkedKeys:r.value,expandedKeys:n.value,"onUpdate:expandedKeys":t[2]||(t[2]=v=>n.value=v),onCheck:Y,onSelect:Z},{title:o(({key:v,title:ce,dataRef:j})=>[l(le,{trigger:["contextmenu"]},{overlay:o(()=>[l(ne,{onClick:t[1]||(t[1]=()=>{})},{default:o(()=>[l(N,{key:"1",onClick:P=>R(j)},{default:o(()=>[Le]),_:2},1032,["onClick"]),l(N,{key:"2",onClick:P=>b.value=v},{default:o(()=>[Re]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[l(I(ye),{visible:b.value===v,title:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",placement:"rightTop",onConfirm:P=>ee(j),onVisibleChange:M},{default:o(()=>[x("span",null,ve(ce),1)]),_:2},1032,["visible","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(h(),C(se,{key:1,description:"\u6682\u65E0\u6570\u636E"}))])]),_:1},8,["spinning"]),l(Ae,{rootTreeData:a.value,onRegister:I(J),onSuccess:m},null,8,["rootTreeData","onRegister"])]),_:1})}}});var kt=pe(Ue,[["__scopeId","data-v-5cc39c49"]]);export{kt as default};
